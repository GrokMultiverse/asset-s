<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GrokMultiverse | Pioneer Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://unpkg.com/@solana/web3.js@1.70.3/lib/index.iife.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@coral-xyz/anchor@0.29.0/dist/browser.anchor.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/buffer/6.0.3/buffer.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&display=swap');
        :root { --cyan: #00f2ff; --blue: #0072ff; --dark: #020202; }
        body { background-color: var(--dark); color: #fff; font-family: 'Space Grotesk', sans-serif; overflow-x: hidden; }
        .glass { background: rgba(255, 255, 255, 0.02); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 24px; }
        .btn-primary { background: linear-gradient(90deg, var(--cyan), var(--blue)); color: #000; font-weight: 800; border-radius: 14px; transition: 0.3s; cursor: pointer; }
        .toast { position: fixed; bottom: 30px; right: 30px; background: var(--cyan); color: #000; padding: 12px 24px; border-radius: 12px; font-weight: bold; transform: translateY(200%); transition: 0.4s; z-index: 9999; }
        .toast.show { transform: translateY(0); }
    </style>
</head>
<body>
<div id="toast" class="toast">Portal Message</div>
    <nav class="max-w-7xl mx-auto flex justify-between items-center p-6 bg-black/40 backdrop-blur-md rounded-3xl mt-4 border border-white/10">
        <div class="flex items-center gap-3">
            <img src="https://raw.githubusercontent.com/GrokMultiverse/asset-s/d3ae39ad61ae3d9045bbcbe94b87cb04932c56ab/logo.png" class="w-10 h-10">
            <span class="font-bold uppercase italic text-xl">Grok<span class="text-cyan-400">Multiverse</span></span>
        </div>
        <button onclick="connectWallet()" id="walletBtn" class="btn-primary px-6 py-2 text-[10px] uppercase">Connect Wallet</button>
    </nav>

    <header class="max-w-7xl mx-auto my-12 p-10 glass text-center">
        <h1 class="text-5xl font-black italic uppercase mb-4">Neural <span class="text-cyan-400">Dashboard</span></h1>
        <p class="text-gray-400 max-w-2xl mx-auto text-sm">Welcome to the GrokMultiverse Pioneer Program. Connect your wallet to initialize your on-chain node and begin earning points.</p>
    </header>
        <main class="max-w-7xl mx-auto px-4">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-12">
            <div class="lg:col-span-2 glass p-8">
                <p id="addrDisplay" class="text-gray-500 font-mono text-[10px] mb-6">WALLET NOT LINKED</p>
                <div class="flex gap-12 mb-8">
                    <div><p class="text-[10px] text-gray-400 uppercase font-bold">Points</p><p id="totalPts" class="text-4xl font-black">0</p></div>
                    <div><p class="text-[10px] text-gray-400 uppercase font-bold">Referrals</p><p id="refCount" class="text-4xl font-black">0</p></div>
                </div>
                <div id="referralSection" class="hidden bg-black/50 p-6 rounded-2xl border border-cyan-400/20">
                    <p class="text-[10px] text-cyan-400 font-black uppercase mb-2">Your Referral Portal</p>
                    <div class="flex flex-col md:flex-row gap-4">
                        <div class="flex-1 bg-white/5 p-3 rounded-lg font-mono text-sm" id="displayRefCode">------</div>
                        <button onclick="copyRefLink()" class="bg-white text-black px-6 py-2 rounded-lg text-xs font-bold uppercase">Copy Link</button>
                    </div>
                </div>
            </div>
            <div class="glass p-8 flex flex-col justify-center items-center text-center">
                <button id="mainActionBtn" onclick="initializeUser()" disabled class="btn-primary w-full py-4 opacity-50 mb-3">Initialize Account</button>
                <p id="actionStatus" class="text-[9px] text-gray-500 uppercase">Connect wallet to unlock</p>
            </div>
        </div>
                <h3 class="text-2xl font-black italic uppercase mb-8">Evolution <span class="text-cyan-400">Phases</span></h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-20">
            <div class="glass p-6"><span class="text-cyan-400 font-bold text-xs italic">Phase 01</span><h4 class="font-bold mt-2">Genesis Portal</h4><p class="text-xs text-gray-500 mt-2">Point engine activation.</p></div>
            <div class="glass p-6"><span class="text-gray-500 font-bold text-xs italic">Phase 02</span><h4 class="font-bold mt-2">Pioneer Sync</h4><p class="text-xs text-gray-500 mt-2">On-chain badge verification.</p></div>
            <div class="glass p-6"><span class="text-gray-500 font-bold text-xs italic">Phase 03</span><h4 class="font-bold mt-2">Multiverse Mint</h4><p class="text-xs text-gray-500 mt-2">Exclusive NFT access.</p></div>
            <div class="glass p-6"><span class="text-gray-500 font-bold text-xs italic">Phase 04</span><h4 class="font-bold mt-2">Utility Layer</h4><p class="text-xs text-gray-500 mt-2">Marketplace integration.</p></div>
            <div class="glass p-6"><span class="text-gray-500 font-bold text-xs italic">Phase 05</span><h4 class="font-bold mt-2">$GROK Launch</h4><p class="text-xs text-gray-500 mt-2">Tokenomics & Staking.</p></div>
            <div class="glass p-6"><span class="text-gray-500 font-bold text-xs italic">Phase 06</span><h4 class="font-bold mt-2">Airdrop Phase</h4><p class="text-xs text-gray-500 mt-2">Reward distribution.</p></div>
        </div>
        </main>
            <script>
        window.Buffer = buffer.Buffer;
        const PROGRAM_ID = new solanaWeb3.PublicKey("DzsNMUqVhpyj6rznbph4jjDKTshPaKdWVHYHDBETYgXE");
        const connection = new solanaWeb3.Connection("https://api.devnet.solana.com", "confirmed");
        let wallet = null, provider = null, program = null;

        const idl = {
            "version": "0.1.0", "name": "grok_multiverse",
            "instructions": [
                { "name": "initializeUser", "accounts": [ { "name": "userStats", "isMut": true }, { "name": "user", "isMut": true }, { "name": "systemProgram", "isMut": false } ], "args": [ { "name": "referrerKey", "type": "publicKey" } ] },
                { "name": "dailyCheckIn", "accounts": [ { "name": "userStats", "isMut": true }, { "name": "user", "isMut": false } ], "args": [] }
            ],
            "accounts": [ { "name": "UserStats", "type": { "kind": "struct", "fields": [ { "name": "owner", "type": "publicKey" }, { "name": "referrer", "type": "publicKey" }, { "name": "points", "type": "u64" }, { "name": "referralCount", "type": "u64" }, { "name": "lastCheckIn", "type": "i64" } ] } } ]
        };
                        async function connectWallet() {
            try {
                const solana = window.phantom?.solana || window.solflare;
                if (!solana) return alert("Install Phantom!");
                const resp = await solana.connect();
                wallet = resp.publicKey;
                provider = new anchor.AnchorProvider(connection, solana, { commitment: "confirmed" });
                program = new anchor.Program(idl, PROGRAM_ID, provider);
                
                document.getElementById('walletBtn').innerText = "LINKED";
                document.getElementById('addrDisplay').innerText = wallet.toString();
                document.getElementById('displayRefCode').innerText = wallet.toString().slice(-6);
                document.getElementById('referralSection').style.display = 'block';
                await syncData();
            } catch (err) { console.error(err); }
        }

        async function syncData() {
            try {
                const [pda] = await solanaWeb3.PublicKey.findProgramAddress([Buffer.from("user-stats"), wallet.toBuffer()], PROGRAM_ID);
                const account = await program.account.userStats.fetch(pda);
                document.getElementById('totalPts').innerText = account.points.toString();
                document.getElementById('refCount').innerText = account.referralCount.toString();
                
                const btn = document.getElementById('mainActionBtn');
                btn.innerText = "Check-In +10"; btn.disabled = false; btn.classList.remove('opacity-50');
                btn.onclick = runDaily;
            } catch (e) {
                const btn = document.getElementById('mainActionBtn');
                btn.disabled = false; btn.classList.remove('opacity-50');
                document.getElementById('actionStatus').innerText = "One-time Init required";
            }
        }

        async function initializeUser() {
            try {
                const [pda] = await solanaWeb3.PublicKey.findProgramAddress([Buffer.from("user-stats"), wallet.toBuffer()], PROGRAM_ID);
                const urlParams = new URLSearchParams(window.location.search);
                const refKey = urlParams.get('ref') || wallet.toString();
                await program.methods.initializeUser(new solanaWeb3.PublicKey(refKey)).accounts({ userStats: pda, user: wallet, systemProgram: solanaWeb3.SystemProgram.programId }).rpc();
                showToast("Node Initialized!"); await syncData();
            } catch (e) { showToast("Error: Check SOL Balance"); }
        }

        async function runDaily() {
            try {
                const [pda] = await solanaWeb3.PublicKey.findProgramAddress([Buffer.from("user-stats"), wallet.toBuffer()], PROGRAM_ID);
                await program.methods.dailyCheckIn().accounts({ userStats: pda, user: wallet }).rpc();
                showToast("Points Claimed!"); await syncData();
            } catch (e) { showToast("Try again in 24h"); }
        }

        function copyRefLink() {
            const link = window.location.origin + window.location.pathname + "?ref=" + wallet.toString();
            navigator.clipboard.writeText(link); showToast("Link Copied!");
        }

        function showToast(m) {
            const t = document.getElementById('toast');
            t.innerText = m; t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>
